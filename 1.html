<!DOCTYPE html>
<html lang="zh-TW">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
   <title>è—¥å¸«è‡¨åºŠåŠ‘é‡æ¯”å°å·¥å…· (Lexicomp/UpToDate)</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <style>
       @keyframes pulse-red {
           0%, 100% { background-color: #fee2e2; border-color: #ef4444; }
           50% { background-color: #fecaca; border-color: #dc2626; }
       }
       .warning-danger { animation: pulse-red 2s infinite; border-width: 2px; }
       
       @keyframes pulse-blue {
           0%, 100% { background-color: #eff6ff; }
           50% { background-color: #dbeafe; }
       }
       .warning-low { animation: pulse-blue 2s infinite; border-width: 2px; border-color: #3b82f6; }

       input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
       input[type=number] { -moz-appearance: textfield; }
       
       .glass-effect {
           backdrop-filter: blur(10px);
           background: rgba(255, 255, 255, 0.9);
       }
   </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans text-slate-900">
   <div class="max-w-md mx-auto bg-white min-h-screen shadow-2xl flex flex-col relative">
       
       <!-- Header -->
       <header class="bg-gradient-to-r from-blue-900 to-indigo-900 p-6 text-white shadow-lg sticky top-0 z-10">
           <h1 class="text-xl font-bold flex items-center gap-2">
               <span class="text-2xl">ğŸ›¡ï¸</span> è‡¨åºŠåŠ‘é‡æ¯”å°å·¥å…·
           </h1>
           <div class="flex justify-between items-center mt-1">
               <p class="text-blue-200 text-xs font-medium tracking-wide">Lexidrug / UpToDate 2024-25</p>
               <span class="bg-blue-800 px-2 py-0.5 rounded text-[10px] uppercase font-bold">Clinical Use Only</span>
           </div>
       </header>

       <!-- Main Content -->
       <main class="flex-1 p-5 space-y-6 pb-32">
           
           <!-- Step 1: Patient & Drug Info -->
           <section class="space-y-4">
               <div class="flex justify-between items-end">
                   <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest">1. åŸºç¤æ•¸æ“šè¼¸å…¥</h2>
               </div>
               <div class="grid grid-cols-2 gap-4">
                   <div class="space-y-1">
                       <label class="text-[11px] font-bold text-slate-500 ml-1">ç—…äººé«”é‡ (kg)</label>
                       <input type="number" id="weight" step="0.1" oninput="calculate()" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all shadow-sm" placeholder="e.g. 65.0">
                   </div>
                   <div class="space-y-1">
                       <label class="text-[11px] font-bold text-slate-500 ml-1">è—¥å“ç¸½é‡ (mg)</label>
                       <input type="number" id="mg" step="0.1" oninput="calculate()" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all shadow-sm" placeholder="e.g. 200">
                   </div>
               </div>
               <div class="grid grid-cols-2 gap-4">
                   <div class="space-y-1">
                       <label class="text-[11px] font-bold text-slate-500 ml-1">æº¶æ¶²é«”ç© (ml)</label>
                       <input type="number" id="ml" step="0.1" oninput="calculate()" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all shadow-sm" placeholder="e.g. 50">
                   </div>
                   <div class="space-y-1">
                       <label class="text-[11px] font-bold text-slate-500 ml-1">ç›®å‰æµé€Ÿ (ml/hr)</label>
                       <input type="number" id="rate" step="0.1" oninput="calculate()" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all shadow-sm" placeholder="e.g. 5.0">
                   </div>
               </div>
           </section>

           <!-- Step 2: Reference Selection (Split into 2 Columns) -->
           <section class="space-y-3">
               <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest">2. é¸æ“‡åƒè€ƒæŒ‡æ¨™</h2>
               <div class="grid grid-cols-2 gap-3">
                   <!-- Column A: Predefined Drugs -->
                   <div class="space-y-2 p-3 bg-blue-50/50 rounded-2xl border border-blue-100">
                       <label class="text-[10px] font-black text-blue-600 uppercase tracking-tighter">A. å·²çŸ¥è—¥å“æ¸…å–®</label>
                       <div class="relative">
                           <select id="drugSelect" onchange="handleDrugSelectChange()" class="w-full bg-white border border-blue-200 rounded-lg py-2 px-2 text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-blue-400 appearance-none cursor-pointer">
                               <option value="custom">-- ä½¿ç”¨è‡ªå®šç¾© --</option>
                               <optgroup label="è¡€ç®¡æ”¶ç¸®åŠ‘">
                                   <option value="dopamine">Dopamine</option>
                                   <option value="norepinephrine">Levophed</option>
                                   <option value="epinephrine">Epinephrine</option>
                                   <option value="dobutamine">Dobutamine</option>
                               </optgroup>
                               <optgroup label="é®éœ/éº»é†‰">
                                   <option value="midazolam">Midazolam</option>
                                   <option value="propofol">Propofol</option>
                                   <option value="dexmedetomidine">Precedex</option>
                               </optgroup>
                               <optgroup label="å…¶ä»–">
                                   <option value="nitroglycerin">NTG</option>
                                   <option value="vasopressin">Vasopressin</option>
                               </optgroup>
                           </select>
                           <div class="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-blue-400 text-[10px]">â–¼</div>
                       </div>
                       <div id="quickInfo" class="text-[9px] text-blue-500 font-medium leading-tight">è«‹é¸æ“‡è—¥å“</div>
                   </div>

                   <!-- Column B: Custom Limits -->
                   <div class="space-y-2 p-3 bg-slate-50 rounded-2xl border border-slate-200">
                       <label class="text-[10px] font-black text-slate-500 uppercase tracking-tighter">B. è‡ªå®šç¾©ä¸Šé™</label>
                       <input type="number" id="customLimit" oninput="handleCustomInputChange()" class="w-full bg-white border border-slate-200 rounded-lg py-2 px-2 text-xs outline-none focus:ring-2 focus:ring-indigo-400 font-bold" placeholder="ä¸Šé™æ•¸å€¼">
                       <select id="customUnit" onchange="calculate()" class="w-full bg-slate-100 rounded-lg py-1 px-1 text-[10px] font-bold outline-none border-none">
                           <option value="mcg/kg/min">mcg/kg/min</option>
                           <option value="mcg/kg/hr">mcg/kg/hr</option>
                           <option value="units/min">Units/min</option>
                       </select>
                   </div>
               </div>
           </section>

           <!-- Step 3: Result Display -->
           <section id="resultArea" class="bg-slate-50 rounded-3xl p-8 text-center transition-all duration-500 border-2 border-transparent shadow-inner">
               <p id="resultLabel" class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-3">Calculated Dose</p>
               
               <div class="flex flex-col items-center justify-center">
                   <div class="flex items-baseline gap-2">
                       <span id="finalDose" class="text-6xl font-black text-slate-800 tracking-tighter tabular-nums">0.00</span>
                   </div>
                   <span id="unitLabel" class="text-slate-500 font-bold text-sm mt-1">mcg/kg/min</span>
               </div>
               
               <div id="statusBadge" class="mt-6 inline-flex items-center gap-2 px-6 py-2 rounded-full text-sm font-black uppercase tracking-wider bg-slate-200 text-slate-500 transition-colors">
                   <span id="statusIcon">âšª</span>
                   <span id="statusText">ç­‰å¾…æ•¸æ“šè¼¸å…¥</span>
               </div>

               <div id="referenceNote" class="mt-6 text-left bg-white/60 p-4 rounded-2xl border border-slate-100 text-[11px] leading-relaxed text-slate-600 hidden">
               </div>
           </section>

       </main>

       <!-- Fixed Footer -->
       <footer class="p-5 bg-white/80 backdrop-blur-md border-t border-slate-100 fixed bottom-0 w-full max-w-md shadow-[0_-10px_20px_rgba(0,0,0,0.02)]">
           <button onclick="resetAll()" class="w-full py-3 rounded-xl text-sm font-bold text-slate-400 hover:text-red-500 hover:bg-red-50 transition-all flex items-center justify-center gap-2">
               <span>ğŸ”„</span> é‡è¨­è¨ˆç®—æ©Ÿ
           </button>
           <p class="text-[9px] text-center text-slate-400 mt-3 leading-normal">
               æœ¬å·¥å…·åƒ…ä¾›è—¥å¸«åƒè€ƒï¼Œä¸æ‡‰å–ä»£è‡¨åºŠå°ˆæ¥­åˆ¤æ–·ã€‚<br>
               åŠ‘é‡æ»´å®šæ‡‰æ ¹æ“šç—…äººä¹‹å³æ™‚è¡€å£“ã€å¿ƒå¾‹åŠè‡¨åºŠåæ‡‰èª¿æ•´ã€‚
           </p>
       </footer>
   </div>

   <script>
       const DRUG_DB = {
           dopamine: {
               name: "Dopamine", min: 2, max: 20, unit: "mcg/kg/min", rangeStr: "2-20 mcg/kg/min",
               note: "<b>Lexidrug:</b><br>â€¢ 1-5: è…è‡ŸåŠ‘é‡<br>â€¢ 5-10: Inotropic<br>â€¢ 10-20: Pressor"
           },
           dobutamine: {
               name: "Dobutamine", min: 2, max: 20, unit: "mcg/kg/min", rangeStr: "2-20 mcg/kg/min",
               note: "<b>Lexidrug:</b><br>â€¢ å¸¸ç”¨åŠ‘é‡ 2-